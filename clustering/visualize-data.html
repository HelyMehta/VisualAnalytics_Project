<html>
  <head>
<style>
    .chart rect {
        fill: steelblue;
    }

        .chart rect:hover {
            fill: turquoise;
        }

    .chart .rectM {
        stroke: green;
        stroke-width: 1;
        fill: green;
        fill-opacity: .2;
    }

        .chart .rectM:hover {
            fill: green;
            fill-opacity: .5;
        }

    .chart text {
        font: 10px sans-serif;
    }

    .chart .title {
        font: 15px sans-serif;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }
    </style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>
</head>
<body>
<div class="chart"></div>
<script>
var height = 400;
var width = 600;
var margin = 40;
var data = [];
// for(var i = 0; i < 100; i++) {
// 	data.push({
//     	danceability: Math.random(),
//         energy: Math.random(),
//         c: Math.random(),
//         popularity: Math.random(),
//         });
// }

// alert(data[0]);

var csv_datafile = "./../csv_data/Rucha_data/Rucha_data.csv"

d3.csv(csv_datafile, function(filedata) {
  // console.log("FILEDATA:", filedata);
  data.push(filedata);
  // filedata.forEach(function(d) {
  //   // console.log("Individual", d);
  //   data.push({
  //     danceability: d.danceability,
  //     energy: d.energy,
  //     popularity: d.popularity,
  //   });
  // });
  // data = d;
});

console.log(data);

var labelX = 'Danceability';
var labelY = 'Energy';
var svg = d3.select('.chart')
                    .append('svg')
                    .attr('class', 'chart')
                    .attr("width", width + margin + margin)
                    .attr("height", height + margin + margin)
                    .append("g")
                    .attr("transform", "translate(" + margin + "," + margin + ")");
                    
// var x = d3.scale.linear()
// 					            .domain([d3.min(data, function (d) { return d.danceability; }), d3.max(data, function (d) { return d.danceability; })])
// 					            .range([0, width]);

var x = d3.scale.linear()
                      .domain([0, 1])
                      .range([0, width]);

// var y = d3.scale.linear()
// 					            .domain([d3.min(data, function (d) { return d.energy; }), d3.max(data, function (d) { return d.energy; })])
// 					            .range([height, 0]);

var y = d3.scale.linear()
                      .domain([0, 1])
                      .range([height, 0]);

// var scale = d3.scale.sqrt()
// 					            .domain([d3.min(data, function (d) { return d.popularity; }), d3.max(data, function (d) { return d.popularity; })])
// 					            .range([1, 20]);

var scale = d3.scale.sqrt()
                      .domain([1, 100])
                      .range([1, 20]);

// var opacity = d3.scale.sqrt()
// 					            .domain([d3.min(data, function (d) { return d.popularity; }), d3.max(data, function (d) { return d.popularity; })])
// 					            .range([1, .5]);

var opacity = d3.scale.sqrt()
                      .domain([1, 100])
                      .range([1, .5]);

var color = d3.scale.category10();

var xAxis = d3.svg.axis().scale(x);
 var yAxis = d3.svg.axis().scale(y).orient("left");
 
  svg.append("g")
					        .attr("class", "y axis")
					        .call(yAxis)
					        .append("text")
						        .attr("transform", "rotate(-90)")
						        .attr("x", 20)
						        .attr("y", -margin)
						        .attr("dy", ".71em")
						        .style("text-anchor", "end")
						        .text(labelY);
                          // x axis and label
                          svg.append("g")
                              .attr("class", "x axis")
                              .attr("transform", "translate(0," + height + ")")
                              .call(xAxis)
                              .append("text")
                                  .attr("x", width + 20)
                                  .attr("y", margin - 10)
                                  .attr("dy", ".71em")
                                  .style("text-anchor", "end")
                                  .text(labelX);
 
svg.selectAll("circle")
                              .data(data)
                              .enter()
                              .insert("circle")
                              .attr("cx", width / 2)
                              .attr("cy", height / 2)
                              .attr("opacity", function (d) { return opacity(d.popularity); })
                              .attr("r", function (d) { return scale(d.popularity); })
                              .style("fill", function (d) { return color(d.c); })
                              .on('mouseover', function (d, i) {
                                  fade(d.c, .1);
                              })
                             .on('mouseout', function (d, i) {
                                 fadeOut();
                             })
                             .transition()
                            .delay(function (d, i) { return x(d.danceability) - y(d.energy); })
                            .duration(500)
                            .attr("cx", function (d) { return x(d.danceability); })
                            .attr("cy", function (d) { return y(d.energy); })
                            .ease("bounce");
                             
                             
function fade(c, opacity) {
                              svg.selectAll("circle")
                                  .filter(function (d) {
                                      return d.c != c;
                                  })
                                .transition()
                                 .style("opacity", opacity);
                          }

                          function fadeOut() {
                              svg.selectAll("circle")
                              .transition()
                                 .style("opacity", function (d) { opacity(d.popularity); });
                          }
</script>
</body>
</html>